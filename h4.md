# h4 Some Disassembly Required

Tehtävänanto löytyy osoitteesta:
<https://terokarvinen.com/application-hacking/#laksyt>

## b)

Aloitin tehtävän lataamalla tehtävänannosta `ezbin-challenges.zip` tiedoston. Tiedosto olikin sama kuin viimetehtävässä, joten `unzip` komennon suorittaessa ylikirjoitin vanhan tiedoston.

Muistin että `packd` binäärissä on packattu tiedosto, jonka arvelin tulevan esteeksi myöhemmin, joten unpackasin sen komennolla `upx -d packd` niinkuin edellisessä tehtävässä. Tämä antoi palautteen "Unpacked 1 file.", joten nyt voin alkaa tutkia binääriä ghidrassa.

Importtasin tiedoston `packd` ghidraan ja ajoin sen samalla suorittaen analyysin. Main funktio löytyi ja aloin tarkastelemaan sitä decompile työkalulla.

<img width="673" height="328" alt="kuva" src="https://github.com/user-attachments/assets/5ba4211b-f0e8-4c05-94f1-30a50f6d28cb" />

Kuvassa olin ehtinyt jo muuttaa `message` muuttujan nimen ensimmäisen vilkaisun aikana, koska se oli mielestäni looginen. Hetken tutkailtuani ohjelmaaa tajusin sen toiminnan ja rupesin muuttamaan muuttujia ja funktioiden nimiä.

**Muutokset:**
* `iVar1` = `checkResult` nimiseksi, koska sen arvoa käytetään vertaamaan if lausekkeeessa salasanan oikeellisuutta.
* `local_28` = `input` nimiseksi, koska sitä vertaillaan oikeaan salasanaan eli kyseessä on käyttäjän syöte.
* `__isoc99_scanf` = `scanf` nimiseksi siivotakseni nimeä. scan tuli jo edellisestä nimestä ja kertoi että tällä scannataan käyttäjän syöte.
* `message` muuttujan vaihdoin ennen kuin kerkesin ottaa sen vanhaa nimeä ylös :D.

Uusisien nimien myötä main funktiosta tuli helposti ymmärretävämpi.

<img width="673" height="328" alt="kuva" src="https://github.com/user-attachments/assets/c4170d88-5bea-4a52-86d5-5b2264b9868c" />

Main toimii siis niin että se lukee kirjoittamasi tekstin, vertaa sitä sanaan "piilos-AnAnAs" ja tulostaa lipun vain jos ne ovat tismalleen samat.

## c)

Avasin `passtr` binäärin ghidrassa ja aloin tutkimaan sen main funktiota. Koitin lisätä muokkauksia suoraan compiler näkymään joka ei kuitenkaan toiminut vaan aiheutti vaan koko ghidran jäätymisen. En saanut ghidraa suljettua käyttöliittymän sulku painikkeista joten kysyin tekoälyltä nopesti miten saan terminaalissa suljettua ghidran. Komennolla `killall -9 java` sulku onnistui ja pääsin kokeilemaan uudestaan.

Etsin tietoa siitä miten koodia voi muokata ghidrassa ja löysin raportin jossa kerrottiin tästä (EDITING AN EXECUTABLE BINARY FILE WITH GHIDRA, 2019). Raportissa näin kuinka compiler ikkunassa voi klikkaamalla haluttua kohtaa avata sen kohdan binäärissä ja muokata sitä siellä. Niimpä klikkasin if lausekkeen alkuvertailua, joka avasi kohdan listing ikkunassa.

<img width="1383" height="661" alt="kuva" src="https://github.com/user-attachments/assets/54e52d4a-4c9c-4e98-a5aa-019da02d230c" />

En tajunnut mitä koodissa tulee muuttaa, joten kysyin tekoälyltä mitä näkyvät `TEST` ja `JNZ` tarkoittaa. Opin että ne ovat hyppykäskyjä, jossa Test on vain vertailu ja JNZ "Jump if Not Zero" on hyppykäsky joka toteutetaan jos test ei palauta 0.

Muutin JNZ rivin muotoon `JZ` "Jump if Zero", jolloin ehto compilerissä muuttui päinvastaiseksi. Rivin muuttaminen onnistuu klikkaamalla kohtaa ja valitsemalla "Patch Instruction". Nyt se palauttaa flagin ja oikein viestin vain jos salasana on joku muu kuin "sala-hakkeri-321".

<img width="1389" height="618" alt="kuva" src="https://github.com/user-attachments/assets/0fec6330-6738-4417-b20e-ecc6647dede3" />

Raportissa kerrottiin kuinka exportataan uusi versio ohjelmasta valikosta valitsemalla file -> Export program. Exportasin uuden "modified" tiedoston samaan pasttr kansioon muodossa "Raw Bites". Annoin käyttöoikeudet exportattuun ohjelmaan komennolla `chmod +x pasttr_modified`, jotta voin ajaa sen.

<img width="946" height="248" alt="kuva" src="https://github.com/user-attachments/assets/9396af44-248b-4371-b3fe-f6d9e2ea67f2" />

Sain kuitenkin virheen "Muistialueen ylitys".

Kokeilin exportata uudestaan, mutta valitsin formaatiksi "Original file" "Raw Bytes" sijaan.

<img width="946" height="248" alt="kuva" src="https://github.com/user-attachments/assets/ac759303-31f4-4df1-87fb-929c0596682b" />

Annoin taas käyttöoikeudet ja nyt sitä pystyi ajamaan. Kokeilin salasanaa "kissa", joka palautti oikean salasanan viestin eli muokkaus toimi.

<img width="946" height="248" alt="kuva" src="https://github.com/user-attachments/assets/f9b39c7f-eef4-4ba6-9520-59a3bb3c4020" />

## d, e )

Aloitin lataamalla tehtävärepositoryn zip tiedostona (https://github.com/NoraCodes/crackmes). Sen jälkeen unzippasin sen komennolla `unzip crackmes-master.zip`. jonka jälkeen sain tehtävät kansioon. Käytin vielä makefile tiedostoa komennolla `make` jotta saan tiedostot käännettyä binääreiksi joita voi tutkia.

<img width="932" height="187" alt="image" src="https://github.com/user-attachments/assets/7137d3c4-5858-46dd-81e4-a12063c7430d" />

Kokeilin ajaa `crackme01` tiedostoa ja se vastasi vain "Need exactly one argument." Tutkin tiedostoa `strings` komennolla ja huomasin siellä rivin "password1".

<img width="932" height="515" alt="image" src="https://github.com/user-attachments/assets/62b5f7e8-824f-4a51-94ea-642baff27038" />

Ajoin ohjelman uudestaan ja syötin parametrinä löydetyn sanan `password1`. Sain vastauksen että salasana oli oikein.

<img width="932" height="53" alt="image" src="https://github.com/user-attachments/assets/c832957c-5054-4981-b667-309b8333a002" />

## e) Crackme01e.64

Kokeilin ajaa sovellusta ja sain saman vastauksen kuin edellisessä tehtävässä.
Strings komennolla löytyi sama `password1`, mutta se ei ollut tällä kertaa. Löytyi myös outo sana `slm!paas.k` jota kokeilin, mutta bash ilmoitti virheen sanassa tai se ei jotenkin ottanut sitä oikein merkkijonona.

<img width="921" height="74" alt="image" src="https://github.com/user-attachments/assets/3537abd3-15d4-47eb-9d23-603193ee1aad" />

Avasin ohjelman ghidrassa. Ghidrassa avasin ohjelman main funktion ja siellä näin että salasanaa verrataan strigiin "slm!paas.k" joten halusin testata vielä uudestaan.

<img width="649" height="430" alt="image" src="https://github.com/user-attachments/assets/4de65eb0-3b24-4bc4-a469-3c0b5485eff2" />

Olin jo aikaisemmin tajunnut, että sanan `slm!paas.k` antaminen parametrinä ei onnistunut koska ohjelma ei tunnistanut sitä. Kokeilin laittaa sanan heittomerkkien sisään jos se auttaisi. Nyt ohjelma tunnisti antamani parametrin joka oli oikein ja se palautti että se on oikea salasana.

<img width="909" height="59" alt="image" src="https://github.com/user-attachments/assets/8943c380-b529-4561-b417-2c5b7456f745" />

## f) crackme02

Ajoin `crackme02.64` ohjelman ja sekin tarvitsi yhden argumentin. Kokeilin taas tutkailla `strings` komennolla. Komento ei antanut mitään epäilyttävää muutakuin `password1`, jota kokeilin mutta se ei ollut oikea. Avasin ghidrassa.

<img width="467" height="573" alt="image" src="https://github.com/user-attachments/assets/6cc14b3a-fa2c-49a5-9479-5b0f3aa43455" />

Main funktio on tällä kertaa monimutkaisempi. Itselläni ei ole c kielestä mitään kokemusta joten näistä ehtolauseista oli todella vaikeaa saada kiinni vaikka googletteli c kielen eri ominaisuuksia ja rakenteita. Lopulta selvittelin tekoälyn kanssa decompilerin koodia ja tajusin idean.

Tehtävässä koodi siis looppaa "password1" sanan läpi ja muuttaa jokaisen merkin sitä edelliseen ASCII merkkiin. Tällöin salasanaksi tulee `o`rrvnqc0`. Testaan sitä.

<img width="920" height="74" alt="image" src="https://github.com/user-attachments/assets/3811675b-1944-4a14-ae96-048b7387fd48" />

Salasana oli oikea.

## Lähteet:
* <https://blog.cjearls.io/2019/04/editing-executable-binary-file-with.html>
* Gemini 3 Pro
* <https://stackoverflow.com/questions/35372423/not-sure-what-to-change-to-let-a-char-break-statement>
* <https://www.reddit.com/r/C_Programming/comments/zut0r9/null_character_0_null_terminated_strings/>
